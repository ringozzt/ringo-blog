# Git å‘½ä»¤æ¸…å•

## git åŸºç¡€æ¦‚å¿µ

Workapceï¼šå·¥ä½œåŒº

Index/Stageï¼šæš‚å­˜åŒº

Repositoryï¼šä»“åº“åŒºï¼ˆæœ¬åœ°ä»“åº“ï¼‰

Remoteï¼šè¿œç¨‹ä»“åº“

ä¸‹é¢çš„<name>ï¼ŒæŒ‡æˆ‘çš„åˆ†æ”¯å

### å¸¸ç”¨çš„æ‹‰ä»£ç æ“ä½œï¼š

```shell
git init

git remote add origin â€œGitHubé¡¹ç›®åœ°å€â€ 		(é€šè¿‡sshæˆ–é…ç½®gitè´¦æˆ·ç„¶åä½¿ç”¨http/https)

git clone â€œGitHubé¡¹ç›®åœ°å€â€		(é€šè¿‡sshæˆ–é…ç½®gitè´¦æˆ·ç„¶åä½¿ç”¨http/https)

git checkout -b <name>
```

### å¸¸ç”¨çš„ä¸€æ¬¡æäº¤è¿‡ç¨‹ï¼š

```shell
git add .

git commit -m "æœ¬æ¬¡æäº¤ä¿¡æ¯"

git pull origin master

# ç®€å†™ git push -u origin masterï½œå®Œæ•´ git push --set-upstream origin master
git push -u origin <name>

git push origin <name>
```

### å¸¸ç”¨æ“ä½œï¼š

```shell
git branch		# æŸ¥çœ‹å½“å‰åˆ†æ”¯

git branch <name>		# åˆ›å»ºåˆ†æ”¯

git checkout <name>		# åˆ‡æ¢åˆ†æ”¯

git checkout -b <name>		# åˆ›å»ºå¹¶åˆ‡æ¢åˆ†æ”¯

git branch -D <name>		# å¼ºè¡Œåˆ é™¤åˆ†æ”¯

git merge <name>		# åˆå¹¶<name>åˆ†æ”¯åˆ°å½“å‰åˆ†æ”¯

git log --oneline  # æŸ¥çœ‹å½“å‰åˆ†æ”¯çš„commitæ—¥å¿—
```

## é‡ç‚¹ï¼šå®é™…åœºæ™¯ - å­¦ä¹ å‘½ä»¤

### åœºæ™¯ä¸€

**æˆ‘æ­£åœ¨ dev åˆ†æ”¯ä¸Šå¼€å‘ï¼Œçªç„¶æ¥äº†ä¸€ä¸ª Jiraï¼Œæˆ‘ä¸å¾—ä¸ä¸¢ä¸‹æ‰‹ä¸­çš„ä»£ç åˆ‡æ¢åˆ° master åˆ†æ”¯æŸ¥çœ‹æƒ…å†µã€‚åªèƒ½æä¸ªä¸´æ—¶çš„ commit ä¿å­˜ç°åœºå—ï¼Ÿ**

#### ä½¿ç”¨ stash

æä¸€ä¸ª commit å½“ç„¶ä¹Ÿå¯ä»¥ï¼Œä½†æ˜¯è¿™ç§æƒ…å†µæœ€é€‚åˆçš„æ“ä½œæ˜¯ `git stash ` æ¥ä¿å­˜ä¸­é—´æ€

```sh
git stash save "half of work"

git checkout master
...

git checkout feature/dev

git stash pop
```

```sh
# æŠŠæ‰€æœ‰æœªæäº¤çš„ä¿®æ”¹ï¼ˆåŒ…æ‹¬æš‚å­˜çš„å’Œéæš‚å­˜çš„ï¼‰éƒ½ä¿å­˜èµ·æ¥
git stash save "msg"

# åº”ç”¨ç¼“å­˜å †æ ˆä¸­çš„ç¬¬ä¸€ä¸ª stash åç§»é™¤å®ƒ
git stash pop

# æŸ¥çœ‹ stash åˆ—è¡¨
git stash list

# åº”ç”¨æŒ‡å®šçš„ stash ï¼Œä½†ä¸åœ¨äº‹åç§»é™¤
git stash apply [stash id]

# æŸ¥çœ‹ stash çš„ diff å†…å®¹
git stash -p [stash id]

# ç§»é™¤æŸä¸ªstash
git stash drop [stash id]

# æ¸…ç©º stash
git stash clear
```

---

### åœºæ™¯äºŒ

**é¡¹ç›®å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå³ä½¿å¯¹åº”çš„åŠŸèƒ½å¹¶æ²¡æœ‰å®Œæˆï¼Œæœ€å¥½æ¯å¤©ä¸‹ç­å‰éƒ½æäº¤ä¸€ä¸‹ commitï¼Œé˜²æ­¢ç”µè„‘æ™šä¸Šå‡ºå•¥é—®é¢˜å¯¼è‡´è¿›åº¦ä¸¢å¤±ã€‚**

**ä¸ºäº†æœ€ç»ˆä¸å‡ºç°å¤ªå¤šæ— æ„ä¹‰çš„æˆ–å«ä¹‰é‡å¤çš„ commitï¼Œæˆ‘è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ**

#### ä½¿ç”¨ amend

```sh
# å°†æœ¬æ¬¡ä¿®æ”¹å’Œä¸Šä¸€æ¬¡ commit åˆå¹¶ï¼Œä¸”å¯ä»¥ä¿®æ”¹ commit msg
# å¦‚æœ amend ä¸è¾“å…¥ -m ï¼Œåˆ™é‡‡ç”¨ä¸Šä¸€æ¬¡ commit çš„msg
# -a å‚æ•°å°±æ˜¯å¯ä»¥æŠŠè¿˜æ²¡æœ‰æ‰§è¡Œaddå‘½ä»¤çš„ä¿®æ”¹ä¸€èµ·æäº¤
git commit -a --amend -m "new msg"
```

---

### åœºæ™¯ä¸‰

**æˆ‘ä¸€ä¸ªäººå¼€å‘æŸé¡¹ç›®ï¼Œä» master æ‹‰å‡ºè‡ªå·±çš„å¼€å‘åˆ†æ”¯ feature/devï¼ŒåŒæ—¶ master ä»åœ¨æ›´æ–°ä¸­ï¼Œæ€æ ·çš„å¼€å‘æ¨¡å¼å¯ä»¥é¿å…æœ€ååˆå¹¶åˆ° master æ—¶æœ‰å¤ªå¤šçš„å†²çªï¼Ÿ**

#### ç­”æ¡ˆæ˜¯ä½¿ç”¨ merge å’Œ rebase

![mergeå’Œrebaseçš„åŒºåˆ«](https://cdn.jsdelivr.net/gh/ringozzt/myPics@main/merge-rebase.png)

#### ç›´è§‚çš„ç»“æœæ˜¯ merge äº§ç”Ÿä¸¤æ ¹çº¿ï¼Œrebase äº§ç”Ÿä¸€æ ¹çº¿ã€‚

merge çš„ä¼˜ç‚¹æ˜¯ä½¿ç”¨ç®€å•ï¼Œä¿ç•™äº†åˆ†æ”¯çš„ç»“æ„ï¼Œä¾¿äºå›æº¯ï¼›ç¼ºç‚¹æ˜¯åˆ†æ”¯ç»“æ„å¤ªå¤šï¼Œçœ‹èµ·æ¥ä¸ç¾è§‚

rebase çš„ä¼˜ç‚¹æ˜¯åˆ†æ”¯ç»“æ„ä¼˜é›…ç¾è§‚ï¼Œç¼ºç‚¹æ˜¯ä¸¢å¤±äº†åˆ†æ”¯ç»“æ„ï¼Œæ¨¡ç³Šäº†åˆ†æ”¯é—´çš„å…³ç³»ï¼Œä¸” rebase è¿‡ç¨‹ä¸­å¯èƒ½è¿›è¡Œå¤šæ¬¡å†²çªçš„è§£å†³ã€‚

```sh
# on feature/dev
# git fetch + git rebase
# git pull æ“ä½œé»˜è®¤çš„ä½¿ç”¨ merge æ–¹å¼å°†è¿œç«¯ä¿®æ”¹æ‹‰åˆ°æœ¬åœ°ï¼Œå¦‚æœ git pull -r å°±ä¼šä½¿ç”¨ rebase å°†è¿œç«¯ä¿®æ”¹æ‹‰åˆ°æœ¬åœ°
git pull origin master -rebase
# or
git merge master


# åˆ‡åˆ°éœ€è¦åˆå¹¶çš„åˆ†æ”¯
git checkout <dev>
# åˆå¹¶<name>åˆ†æ”¯åˆ°å½“å‰åˆ†æ”¯
git merge <master>

# åˆ‡åˆ°éœ€è¦åˆå¹¶çš„åˆ†æ”¯ï¼Œä¹Ÿå°±æ˜¯ å¾…å˜åŸºåˆ†æ”¯ã€å½“å‰åˆ†æ”¯
git checkout <dev>
# ç›¸å½“äºæŠŠ<dev>çš„æ ‘ææ°æ–­ï¼Œå«æ¥åˆ° åŸºåˆ†æ”¯<master> å°¾ç«¯
git rebase <master>

# å®˜æ–¹è§£é‡Šï¼šå½“æ‰§è¡Œ rebase æ“ä½œæ—¶ï¼Œgit ä¼šä»ä¸¤ä¸ªåˆ†æ”¯çš„å…±åŒç¥–å…ˆå¼€å§‹æå–â€˜å¾…å˜åŸºåˆ†æ”¯ä¸Šçš„ä¿®æ”¹â€™ï¼Œç„¶åå°†å¾…å˜åŸºåˆ†æ”¯æŒ‡å‘åŸºåˆ†æ”¯çš„æœ€æ–°æäº¤ï¼Œæœ€åå°†åˆšæ‰â€˜æå–çš„ä¿®æ”¹â€™åº”ç”¨åˆ°â€˜åŸºåˆ†æ”¯çš„æœ€æ–°æäº¤â€™çš„åé¢ã€‚
```

å…·ä½“ä½¿ç”¨ä¸Šä¸¤è€…æ²¡æœ‰å¥½åä¹‹åˆ†ï¼Œæ ¹æ®å›¢é˜Ÿçº¦å®šå³å¯ã€‚

ä½†æ˜¯å¤šäººåä½œçš„åœºæ™¯ï¼Œæ¯”å¦‚æœ‰äººåœ¨ä»¥æˆ‘çš„ feature/dev åˆ†æ”¯ä¸ºåŸºç¡€è¿›è¡Œå¼€å‘ï¼Œè¦æ…ç”¨ rebaseã€‚

```javascript
rebase å·¥ä½œæµï¼š
git rebase
while(å­˜åœ¨å†²çª) {
    git status
    æ‰¾åˆ°å½“å‰å†²çªæ–‡ä»¶ï¼Œç¼–è¾‘è§£å†³å†²çª
    git add -u
    git rebase --continue
    if( git rebase --abort )
        break;
}
mergeå·¥ä½œæµ ï¼š
1.git pull  (æˆ–fetch && merge)
2.ç¼–è¾‘å†²çªæ–‡ä»¶
3.git pull
```

---

### åœºæ™¯å››

**é¡¹ç›®å¼€å‘è¿‡ç¨‹ä¸­æ²¡æœ‰ä½¿ç”¨ git commit --amend æ•´ç† commit è®°å½•ã€‚å¯ä»¥åœ¨é¡¹ç›®å¼€å‘å®Œæäº¤ cr æˆ– mr ä¹‹å‰ï¼Œå†å¯¹ commit è¿›è¡Œæ•´ç†åˆå¹¶å—ï¼Ÿ**

#### ç­”æ¡ˆè¿˜æ˜¯ `git rebase`

```sh
# on feature/dev
# åˆå¹¶ä» startpoint åˆ° endpoint çš„commitï¼Œendpoint é»˜è®¤ä¸ºHEAD
git rebase -i <startpoint> [endpoint]
#or
# åˆå¹¶ä» HEAD ç‰ˆæœ¬å¼€å§‹å¾€è¿‡å»æ•° N ä¸ªç‰ˆæœ¬
git rebase -i HEAD~N
```

1. è¾“å…¥ä¸Šé¢çš„ä»»æ„ä¸€æ¡å‘½ä»¤åï¼Œåˆ†ä¸ºä¸¤ä¸ªåŒºåŸŸï¼Œå‘½ä»¤ç¼–è¾‘åŒºå’Œå‘½ä»¤è¯´æ˜åŒºã€‚

2. åœ¨å‘½ä»¤ç¼–è¾‘åŒºå°† pick æ”¹æˆ s ä»£è¡¨åˆå¹¶æ­¤ commit ï¼Œå°†ä¸‹é¢ä¸¤ä¸ª pick æ”¹ä¸º s å°±æ˜¯åˆå¹¶åˆ°ç¬¬ä¸€ä¸ª commitï¼Œ

   å®Œæˆç¼–è¾‘åé€šè¿‡ vim çš„ `:wq` æˆ– `:x` å¯ä»¥ä¿å­˜å¹¶é€€å‡ºï¼Œè¿›å…¥ä¸‹ä¸€ä¸ª msg ä¿®æ”¹ç•Œé¢ï¼Œ

3. ä¿®æ”¹æäº¤ä¿¡æ¯åï¼ŒåŒæ ·é€šè¿‡ vim çš„ `:wq` æˆ– `:x` å¯ä»¥ä¿å­˜å¹¶é€€å‡ºã€‚

è‡³æ­¤ï¼Œæ•´ä¸ªåˆå¹¶æ“ä½œä¾¿å®Œæˆäº†~

æ­å–œä½ ï¼Œå˜åŸºæˆåŠŸ ï¼šï¼‰ğŸ¤ª

![rebaseå›¾ç¤º](https://cdn.jsdelivr.net/gh/ringozzt/myPics@main/rebase-process.png)

---

### åœºæ™¯äº”

**å‡è®¾ v2 æ˜¯ç¨³å®šç‰ˆæœ¬çš„åˆ†æ”¯ï¼Œv3 æ˜¯å¼€å‘ç‰ˆæœ¬çš„åˆ†æ”¯ï¼Œæˆ‘ä»¬ä¸èƒ½ç›´æ¥æŠŠä¸¤ä¸ªåˆ†æ”¯åˆå¹¶ï¼Œè¿™æ ·ä¼šå¯¼è‡´ç¨³å®šç‰ˆæœ¬æ··ä¹±ï¼Œä½†æ˜¯åˆæƒ³å¢åŠ ä¸€ä¸ª v3 çš„åŠŸèƒ½åˆ° v2 ä¸­ï¼Œæ€ä¹ˆåŠï¼Ÿ**

![cherryå›¾ç¤º](https://cdn.jsdelivr.net/gh/ringozzt/myPics@main/cherry-pick.png)

#### git cherry-pick å¯ä»¥è§£å†³

```sh
# å°†æŒ‡å®šçš„æäº¤ commitHash åº”ç”¨äºå½“å‰åˆ†æ”¯
git cherry-pick <commitHash>

# æ”¯æŒä¸€æ¬¡ pick å¤šä¸ªæäº¤
git cherry-pick <HashA> <HashB>

# è½¬ç§»ä» A åˆ° B çš„æ‰€æœ‰æäº¤ã€‚ä¸” A å¿…é¡»æ—©äº B
# Aä¸è¢«åŒ…å«åœ¨ Cherry-pick ä¸­ï¼Œå·¦å¼€å³é—­ï¼Œ(A, B]
git cherry-pick A..B

# ä½œç”¨åŒä¸Šï¼Œä½† A åŒ…å«åœ¨ Cherry-pick ä¸­, å·¦é—­å³é—­ï¼Œ[A, B]
git cherry-pick A^..B
```

---

### merge å’Œ rebase è§£å†³å†²çª

ä¸Šé¢çš„ä¸€äº›å‘½ä»¤ä¸­ï¼Œå®¹æ˜“äº§ç”Ÿå†²çªçš„æœ‰ mergeã€rebaseã€cherry-pickï¼›å…¶ä¸­ rebase å’Œ cherry-pick ç±»ä¼¼ï¼Œå¯èƒ½è¿ç»­å†²çªå¤šæ¬¡ï¼Œéœ€è¦ä½¿ç”¨ continue æ¨è¿›ä¸‹ä¸€æ­¥ã€‚

**rebaseã€cherry-pick çš„å†²çªæ˜¯ä¸€ä¸ªä¸€ä¸ªè§£å†³ï¼Œå¦‚æœæœ‰åä¸ªå†²çªæ€ä¹ˆåŠå‘¢ï¼ŒæŒ‰ç…§ä¸‹åˆ—å‘½ä»¤æ‰§è¡Œ**ï¼š

```shell
1. æŸ¥çœ‹å¹¶æ‰‹åŠ¨è§£å†³å†²çª

2. git commit -a -m "msg"

3. git rebase â€“contiune

4. å¾ªç¯ä¸Šé¢ä¸‰ä¸ªæ­¥éª¤ç›´åˆ° rebase æˆåŠŸ
```

**è€Œ merge æ˜¯æ‰€æœ‰çš„å†²çªéƒ½ä¼šä¸€æ¬¡æ€§æ˜¾ç¤ºå‡ºæ¥ã€‚**

**å¦å¤–å¦‚æœ rebase è¿‡ç¨‹ä¸­ï¼Œä½ æƒ³ä¸­é€”é€€å‡ºï¼Œæ¢å¤ rebase å‰çš„ä»£ç åˆ™å¯ä»¥ç”¨å‘½ä»¤**

```shell
git rebase â€“abort

git push origin <name>		# rebaseå‰æœ€å¥½å…ˆpush <name>åˆ°è¿œç«¯ï¼Œç•™ä¸‹ä¸€äº›è®°å½•
```

---

### git pull

**git pull == git fetch(è·å–) + git merge(åˆå¹¶)**

git merge å‰ä¸€å®šè¦ git fetchï¼Œå› ä¸º git fetch ç›¸å½“äºå°† â€˜è¿œç¨‹ä»“åº“çš„å†…å®¹ â€™ æ›´æ–°åˆ° â€˜è¿œç¨‹ä»“åº“å‰¯æœ¬â€™

`git fetch`æ˜¯å°†è¿œç¨‹ä¸»æœºçš„æœ€æ–°å†…å®¹æ‹‰åˆ°æœ¬åœ°ï¼Œç”¨æˆ·åœ¨æ£€æŸ¥äº†ä»¥åå†³å®šæ˜¯å¦åˆå¹¶åˆ°å·¥ä½œæœ¬æœºåˆ†æ”¯ä¸­ã€‚

è€Œ`git pull` åˆ™æ˜¯å°†è¿œç¨‹ä¸»æœºçš„æœ€æ–°å†…å®¹æ‹‰ä¸‹æ¥åç›´æ¥åˆå¹¶ï¼Œå³ï¼š`git pull = git fetch + git merge`ï¼Œè¿™æ ·å¯èƒ½ä¼šäº§ç”Ÿå†²çªï¼Œéœ€è¦æ‰‹åŠ¨è§£å†³ã€‚

**ä¼ä¸šçº§ç†è§£ï¼š**

fecth åªè·å–ä¿¡æ¯ï¼Œä¸åŠ¨ä½ çš„ä¸œè¥¿ã€‚ç­‰äºä½ æµè§ˆäº†ç½‘é¡µï¼ŒçŸ¥é“å‘æ–°ç•ªäº†ï¼Œä½ ä¹Ÿèƒ½ä¸Š B ç«™çœ‹ï¼Œç„¶è€Œä½ æœ¬åœ°ä¹ˆä¹Ÿæ— æœ‰ã€‚

pull å°±æ˜¯ä½ çœ‹åˆ°å‘æ–°ç•ªäº†ï¼ŒæŠŠå®ƒä¸‹è½½ä¸‹æ¥ï¼Œå°å¿ƒç¿¼ç¿¼çš„å¤‡ä»½åˆ°äº†ä½ ä¸ªäººæœ¬åœ°çš„ç‰‡åº“é‡Œã€‚

---

### å›æ»š

![revert-reset](https://cdn.jsdelivr.net/gh/ringozzt/myPics@main/gitreset.png)

#### æ ¸å¿ƒåŒºåˆ«ï¼šæ˜¯å¦ç”Ÿæˆäº†ä¸€ä¸ª revert-commit

ç”±äºå›æ»šå®Œè¿˜æ˜¯éœ€è¦ MRï¼Œæˆ‘ä»¬ä¸€èˆ¬ç›´æ¥æ“ä½œ gitlab æˆ–è€… github ä¸Šçš„è¿˜åŸï¼Œè¿™ä¸ªè¿˜åŸå…¶å®å°±æ˜¯ git revert

#### ä½†æ˜¯åœ¨åˆå¹¶ä¸»åˆ†æ”¯åï¼Œè¦æ³¨æ„æ“ä½œé¡ºåº

<img src="https://cdn.jsdelivr.net/gh/ringozzt/myPics@main/revert-trap.png" style="zoom:35%;" />

### GUI è½¯ä»¶æœ‰åŠ©äºç†è§£ Git

1. Sourcetree
2. Github Desktop
3. vscode æ’ä»¶ Git Graph

---

## æ€»ç»“ï¼š

1. stash æš‚å­˜å‘½ä»¤
2. amend åˆå¹¶/ä¿®æ”¹ä¸Šä¸€ä¸ª commit
3. merge åˆ†æ”¯åˆå¹¶
4. rebase å˜åŸº or åˆå¹¶ commit
5. cherry-pick æ‘˜å–æŒ‡å®š commit
6. git pull == fetch + merge
7. ä¸¤ç§å›æ»šåŒºåˆ«ï¼šæ˜¯å¦ç”Ÿæˆäº†ä¸€ä¸ª revert-commit

##### å‚è€ƒæ–‡ç« ï¼š

1. é™æ€çš„å‘½ä»¤è¡Œä»‹ç»
2. [å¸¸ç”¨ Git å‘½ä»¤æ¸…å•](https://www.ruanyifeng.com/blog/2015/12/git-cheat-sheet.html)
3. [Git è¿œç¨‹æ“ä½œè¯¦è§£](https://www.ruanyifeng.com/blog/2014/06/git_remote.html)
4. [rebase è¯¦è§£â€”â€”éå¸¸ç²¾é«“](https://blog.csdn.net/t949500898/article/details/108572456)
