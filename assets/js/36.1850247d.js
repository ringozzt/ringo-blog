(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{587:function(t,s,a){"use strict";a.r(s);var n=a(13),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"跨域问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#跨域问题"}},[t._v("#")]),t._v(" 跨域问题")]),t._v(" "),a("h2",{attrs:{id:"浏览器同源策略"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#浏览器同源策略"}},[t._v("#")]),t._v(" 浏览器同源策略")]),t._v(" "),a("p",[t._v("浏览器厂商设置的一个重要的安全策略，看一下 MDN 对浏览器同源策略的介绍：")]),t._v(" "),a("blockquote",[a("p",[a("strong",[t._v("同源策略")]),t._v("是一个重要的安全策略，它用于限制一个"),a("a",{attrs:{href:"https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FGlossary%2FOrigin",target:"_blank",rel:"noopener noreferrer"}},[t._v("origin"),a("OutboundLink")],1),t._v("的文档或者它加载的脚本如何能与另一个源的资源进行交互。它能帮助阻隔恶意文档，减少可能被攻击的媒介。")])]),t._v(" "),a("p",[t._v("如果缺少同源策略，浏览器很容易受到"),a("code",[t._v("XSS")]),t._v("、"),a("code",[t._v("CSRF")]),t._v("等攻击。")]),t._v(" "),a("p",[t._v("只有协议、域名、端口都相同的情况下，才属于同源。反之，如果三者有一个不一致，就会产生跨域。")]),t._v(" "),a("p",[a("strong",[t._v("都说是浏览器的策略，那么服务器当然是可以收到请求并正常响应的，只是浏览器拒绝接收了而已。")])]),t._v(" "),a("p",[t._v("一个原则："),a("strong",[t._v("同源策略只存在浏览器端")]),t._v("，服务器是没有跨域问题的，用"),a("code",[t._v("postman")]),t._v("等工具也不会出现跨域问题")]),t._v(" "),a("h2",{attrs:{id:"domain"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#domain"}},[t._v("#")]),t._v(" domain")]),t._v(" "),a("h3",{attrs:{id:"单点登录的技术基础"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#单点登录的技术基础"}},[t._v("#")]),t._v(" 单点登录的技术基础")]),t._v(" "),a("p",[t._v("domain 标识指定了哪些主机可以访问该 Cookie 的域名。如果设置为“.google.com”，则所有以“google.com”结尾的域名都可以访问该 Cookie。"),a("strong",[t._v("注意第一个字符必须为“.”")])]),t._v(" "),a("h2",{attrs:{id:"解决跨域"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#解决跨域"}},[t._v("#")]),t._v(" 解决跨域")]),t._v(" "),a("h3",{attrs:{id:"cors"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cors"}},[t._v("#")]),t._v(" CORS")]),t._v(" "),a("p",[t._v("虽说浏览器会默认拦截服务端返回的跨域请求数据，但是也是有办法让浏览器把这个拦截关掉的，那就是使用"),a("strong",[t._v("CORS")]),t._v("。"),a("strong",[t._v("CORS")]),t._v("是一个"),a("code",[t._v("W3C")]),t._v('标准，全称是"跨域资源共享"，它允许浏览器向跨域服务器，发出'),a("code",[t._v("XMLHttpRequest")]),t._v("请求，从而克服同源的限制。")]),t._v(" "),a("p",[a("code",[t._v("CORS")]),t._v("需要浏览器和服务器同时支持，目前所有最新浏览器都支持该功能，但是不能低于 IE10。"),a("a",{attrs:{href:"https://caniuse.com/?search=cors",target:"_blank",rel:"noopener noreferrer"}},[t._v("查看浏览器兼容 CORS 情况"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("code",[t._v("CORS")]),t._v("实现的本质，就是在浏览器请求中，自动添加一些附加的头信息。整个"),a("code",[t._v("CORS")]),t._v("通信过程，都是浏览器自动完成，不需要用户参与。对于开发者来说，"),a("code",[t._v("CORS")]),t._v("通信与同源的"),a("code",[t._v("Ajax")]),t._v("通信没有差别，代码完全一样，对于用户来说，也是无感知的。")]),t._v(" "),a("p",[t._v("首先需要清楚两个概念: "),a("strong",[t._v("简单请求")]),t._v("和"),a("strong",[t._v("非简单请求")]),t._v("。")]),t._v(" "),a("p",[t._v("凡是满足下面条件的属于"),a("strong",[t._v("简单请求")]),t._v(":")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("请求方法为 GET、POST 或者 HEAD")])]),t._v(" "),a("li",[a("p",[t._v("请求头的取值范围:")]),t._v(" "),a("p",[t._v("Accept、Accept-Language、")]),t._v(" "),a("p",[t._v("Content-Language、")]),t._v(" "),a("p",[t._v("Content-Type(只限于三个值"),a("code",[t._v("application/x-www-form-urlencoded")]),t._v("、"),a("code",[t._v("multipart/form-data")]),t._v("、"),a("code",[t._v("text/plain")]),t._v(")")])])]),t._v(" "),a("p",[t._v("浏览器画了这样一个圈，在这个圈里面的就是"),a("strong",[t._v("简单请求")]),t._v(", 圈外面的就是"),a("strong",[t._v("非简单请求")]),t._v("，然后针对这两种不同的请求进行不同的处理。")]),t._v(" "),a("h4",{attrs:{id:"简单请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#简单请求"}},[t._v("#")]),t._v(" 简单请求")]),t._v(" "),a("p",[t._v("请求发出去之前，浏览器做了什么？")]),t._v(" "),a("h5",{attrs:{id:"access-control-allow-origin"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#access-control-allow-origin"}},[t._v("#")]),t._v(" Access-Control-Allow-Origin")]),t._v(" "),a("p",[t._v("它会自动在请求头当中，添加一个"),a("code",[t._v("Origin")]),t._v("字段，用来说明请求来自哪个"),a("code",[t._v("源")]),t._v("。服务器拿到请求之后，在回应时对应地添加"),a("code",[t._v("Access-Control-Allow-Origin")]),t._v("字段，如果"),a("code",[t._v("Origin")]),t._v("不在这个字段的范围中，那么浏览器就会将响应拦截(*为所有)。")]),t._v(" "),a("p",[t._v("因此，"),a("code",[t._v("Access-Control-Allow-Origin")]),t._v("字段是服务器用来决定浏览器是否拦截这个响应，这是必需的字段。与此同时，其它一些可选的功能性的字段，用来描述如果不会拦截，这些字段将会发挥各自的作用。")]),t._v(" "),a("h5",{attrs:{id:"access-control-allow-credentials"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#access-control-allow-credentials"}},[t._v("#")]),t._v(" "),a("strong",[t._v("Access-Control-Allow-Credentials")])]),t._v(" "),a("p",[t._v("这个字段是一个布尔值，表示是否允许发送 Cookie，对于跨域请求，浏览器对这个字段默认值设为 false，而如果需要拿到浏览器的 Cookie，需要添加这个响应头并设为"),a("code",[t._v("true")]),t._v(", 并且在前端也需要设置"),a("code",[t._v("withCredentials")]),t._v("属性:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("let xhr = new XMLHttpRequest();\nxhr.withCredentials = true;\n\n")])])]),a("h5",{attrs:{id:"access-control-expose-headers"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#access-control-expose-headers"}},[t._v("#")]),t._v(" "),a("strong",[t._v("Access-Control-Expose-Headers")])]),t._v(" "),a("p",[t._v("这个字段是给 XMLHttpRequest 对象"),a("strong",[t._v("赋能")]),t._v("，让它不仅可以拿到基本的 6 个响应头字段（包括"),a("code",[t._v("Cache-Control")]),t._v("、"),a("code",[t._v("Content-Language")]),t._v("、"),a("code",[t._v("Content-Type")]),t._v("、"),a("code",[t._v("Expires")]),t._v("、"),a("code",[t._v("Last-Modified")]),t._v("和"),a("code",[t._v("Pragma")]),t._v("）, 还能拿到这个字段声明的"),a("strong",[t._v("响应头字段")]),t._v("。比如这样设置:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Access-Control-Expose-Headers: aaa\n")])])]),a("p",[t._v("那么在前端可以通过 "),a("code",[t._v("XMLHttpRequest.getResponseHeader('aaa')")]),t._v(" 拿到 "),a("code",[t._v("aaa")]),t._v(" 这个字段的值。")]),t._v(" "),a("h4",{attrs:{id:"非简单请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#非简单请求"}},[t._v("#")]),t._v(" 非简单请求")]),t._v(" "),a("p",[t._v("那么"),a("strong",[t._v("PUT 请求")]),t._v("或者"),a("strong",[t._v("请求头包含其他字段")]),t._v("，就属于非简单请求")]),t._v(" "),a("p",[t._v("非简单请求的特殊体现在两个方面: "),a("strong",[t._v("预检请求")]),t._v("和"),a("strong",[t._v("响应字段")]),t._v("。")]),t._v(" "),a("p",[t._v("非简单请求的"),a("code",[t._v("CORS")]),t._v("请求是会在正式通信之前进行一次"),a("strong",[t._v("预检请求")])]),t._v(" "),a("p",[t._v("浏览器先询问服务器,当前网页所在的域名是否可以请求您的服务器,以及可以使用那些"),a("code",[t._v("HTTP")]),t._v("动词和头信息,只有得到正确的答复,才会进行正式的请求")]),t._v(" "),a("p",[t._v("我们以 PUT 方法为例。")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" url "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://xxx.com'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" xhr "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("XMLHttpRequest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nxhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("open")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'PUT'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nxhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setRequestHeader")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'X-Custom-Header'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'xxx'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nxhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("当这段代码执行后，首先会发送"),a("strong",[t._v("预检请求")]),t._v("。这个预检请求的请求行和请求体是下面这个格式:")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("OPTIONS")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("cors "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("HTTP")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.1")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("Origin")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" 当前地址\n"),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("Host")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" xxx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com\nAccess"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Control"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Request"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Method"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("PUT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 表示请求方法")]),t._v("\nAccess"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Control"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Request"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Headers"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("X")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Custom"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Header "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 表示浏览器发送的自定义字段")]),t._v("\n")])])]),a("p",[t._v("预检请求的方法是"),a("code",[t._v("OPTIONS")]),t._v("，同时会加上"),a("code",[t._v("Origin")]),t._v("源地址和"),a("code",[t._v("Host")]),t._v("目标地址，这很简单。同时也会加上两个关键的字段:")]),t._v(" "),a("ul",[a("li",[t._v("Access-Control-Request-Method，列出 CORS 请求用到哪个 HTTP 方法")]),t._v(" "),a("li",[t._v("Access-Control-Request-Headers，指定 CORS 请求将要加上什么请求头")])]),t._v(" "),a("p",[t._v("这是"),a("code",[t._v("预检请求")]),t._v("。这时服务器响应有两种可能：")]),t._v(" "),a("h5",{attrs:{id:"服务器否定了-预检-请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#服务器否定了-预检-请求"}},[t._v("#")]),t._v(" 服务器否定了"),a("code",[t._v('"预检"')]),t._v("请求")]),t._v(" "),a("p",[t._v("会返回一个正常的"),a("code",[t._v("HTTP")]),t._v("回应，但是没有任何"),a("code",[t._v("CORS")]),t._v("的头相关信息，这时浏览器就认定，服务器不允许此次访问，从而抛出错误。")]),t._v(" "),a("h5",{attrs:{id:"服务器允许这次非简单请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#服务器允许这次非简单请求"}},[t._v("#")]),t._v(" "),a("strong",[t._v("服务器允许这次非简单请求")])]),t._v(" "),a("p",[t._v("接下来是"),a("strong",[t._v("响应字段")]),t._v("，响应字段也分为两部分，一部分是对于"),a("strong",[t._v("预检请求")]),t._v("的响应，一部分是对于 "),a("strong",[t._v("CORS 请求")]),t._v("的响应。")]),t._v(" "),a("p",[t._v("如下面的格式:")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("HTTP")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("OK")]),t._v("\nAccess"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Control"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Allow"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Origin"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("\nAccess"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Control"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Allow"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Methods"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("GET")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("POST")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("PUT")]),t._v("\nAccess"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Control"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Allow"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Headers"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("X")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Custom"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Header\nAccess"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Control"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Allow"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Credentials"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\nAccess"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Control"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Max"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Age"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1728000")]),t._v("\nContent"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Type"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" text"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" charset"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("utf"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),t._v("\nContent"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Encoding"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" gzip\nContent"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Length"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n")])])]),a("p",[t._v("其中有这样几个关键的"),a("strong",[t._v("响应头字段")]),t._v(":")]),t._v(" "),a("ul",[a("li",[t._v("Access-Control-Allow-Origin: 表示可以允许请求的源，可以填具体的源名，也可以填"),a("code",[t._v("*")]),t._v("表示允许任意源请求。")]),t._v(" "),a("li",[t._v("Access-Control-Allow-Methods: 表示允许的请求方法列表。")]),t._v(" "),a("li",[t._v("Access-Control-Allow-Credentials: 简单请求中已经介绍。")]),t._v(" "),a("li",[t._v("Access-Control-Allow-Headers: 表示允许发送的请求头字段")]),t._v(" "),a("li",[t._v("Access-Control-Max-Age: 预检请求的有效期，在此期间，不用发出另外一条预检请求。")])]),t._v(" "),a("p",[t._v("在预检请求的响应返回后，如果请求不满足响应头的条件，则触发"),a("code",[t._v("XMLHttpRequest")]),t._v("的"),a("code",[t._v("onerror")]),t._v("方法，当然后面真正的"),a("strong",[t._v("CORS 请求")]),t._v("也不会发出去了。")]),t._v(" "),a("h5",{attrs:{id:"cors-请求的响应"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cors-请求的响应"}},[t._v("#")]),t._v(" "),a("strong",[t._v("CORS 请求的响应")])]),t._v(" "),a("p",[t._v("浏览器自动加上"),a("code",[t._v("Origin")]),t._v("字段，服务端响应头返回"),a("strong",[t._v("Access-Control-Allow-Origin")]),t._v("。可以参考以上简单请求部分的内容。")]),t._v(" "),a("hr"),t._v(" "),a("h3",{attrs:{id:"jsonp"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jsonp"}},[t._v("#")]),t._v(" JSONP")]),t._v(" "),a("p",[t._v("虽然"),a("code",[t._v("XMLHttpRequest")]),t._v("对象遵循同源政策，但是"),a("code",[t._v("script")]),t._v("标签不一样，它可以通过 src 填上目标地址从而发出 GET 请求，实现跨域请求并拿到响应。")]),t._v(" "),a("ul",[a("li",[t._v("客户端事先在 script 标签里准备一个接收数据的全局函数")]),t._v(" "),a("li",[t._v("客户端构造一个 script 标签，url 中拼接：请求地址+"),a("code",[t._v("callback=上一步声明的函数名")]),t._v("其中键名 callback 与后端确定，参数以 get 形式拼接")]),t._v(" "),a("li",[t._v("客户端解析到 script 脚本，发出请求")]),t._v(" "),a("li",[t._v("服务端响应一个 JSON 对象")]),t._v(" "),a("li",[t._v("自定义函数接收到 res，执行函数体")])]),t._v(" "),a("h4",{attrs:{id:"封装一个-jsonp"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#封装一个-jsonp"}},[t._v("#")]),t._v(" 封装一个 JSONP:")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("jsonp")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" params"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" callbackName "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("generateURL")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" dataStr "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" key "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" params"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      dataStr "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("params"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("&")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    dataStr "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("callback=")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("callbackName"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("url"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("?")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("dataStr"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Promise")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("resolve"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" reject")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 初始化回调函数名称")]),t._v("\n    callbackName "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" callbackName "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" Math"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("random")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("toString"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("replace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("','")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 创建 script 元素并加入到当前文档中")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" scriptEle "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createElement")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'script'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    scriptEle"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("src "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("generateURL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("appendChild")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("scriptEle"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 绑定到 window 上，为了后面调用")]),t._v("\n    window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("callbackName"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("data")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// script 执行完了，成为无用元素，需要清除")]),t._v("\n      document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("removeChild")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("scriptEle"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h4",{attrs:{id:"服务端-jsonp"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#服务端-jsonp"}},[t._v("#")]),t._v(" 服务端 JSONP")]),t._v(" "),a("p",[t._v("当然在服务端也会有响应的操作, 以 express 为例:")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" express "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'express'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" app "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("express")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\napp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" callback "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("query"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 1")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 2")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 注意哦，返回给script标签，浏览器直接把这部分字符串执行")]),t._v("\n  res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("end")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("callback"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("('数据包')")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\napp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("listen")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("前端这样简单地调用一下就好了:")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("jsonp")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("url")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://localhost:3000'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("params")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("a")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("b")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("data")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 拿到数据进行处理")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 数据包")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("和"),a("code",[t._v("CORS")]),t._v("相比，JSONP 最大的优势在于兼容性好，IE 低版本不能使用 CORS 但可以使用 JSONP，缺点也很明显，请求方法单一，只支持 GET 请求。")]),t._v(" "),a("h3",{attrs:{id:"ajax-和-jsonp"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ajax-和-jsonp"}},[t._v("#")]),t._v(" Ajax 和 JSONP")]),t._v(" "),a("h4",{attrs:{id:"相同点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#相同点"}},[t._v("#")]),t._v(" 相同点：")]),t._v(" "),a("ul",[a("li",[t._v("使用的目的一致，都是客户端向服务端请求数据，将数据拿回客户端进行处理。")])]),t._v(" "),a("h4",{attrs:{id:"不同点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#不同点"}},[t._v("#")]),t._v(" 不同点：")]),t._v(" "),a("ul",[a("li",[t._v("ajax 请求是一种官方推出的请求方式，通过 xhr 对象去实现，jsonp 是民间发明，script 标签实现的请求。")]),t._v(" "),a("li",[t._v("ajax 是一个异步请求，jsonp 是一个同步请求")]),t._v(" "),a("li",[t._v("ajax 存在同源检查，jsonp 不存在同源检查，后端无需做解决跨域的响应头。")]),t._v(" "),a("li",[t._v("ajax 支持各种请求的方式，而 jsonp 只支持 get 请求")]),t._v(" "),a("li",[t._v("ajax 的使用更加简便，而 jsonp 的使用较为麻烦。")])]),t._v(" "),a("h3",{attrs:{id:"既然jsonp可以跨域-那为什么还要使用cors呢"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#既然jsonp可以跨域-那为什么还要使用cors呢"}},[t._v("#")]),t._v(" "),a("strong",[t._v("既然Jsonp可以跨域,那为什么还要使用CORS呢")])]),t._v(" "),a("ul",[a("li",[a("code",[t._v("jsonp")]),t._v("只可以使用 "),a("code",[t._v("GET")]),t._v(" 方式提交")]),t._v(" "),a("li",[t._v("不好调试,在调用失败的时候不会返回任何状态码")]),t._v(" "),a("li",[t._v("安全性,万一假如提供"),a("code",[t._v("jsonp")]),t._v("的服务存在页面注入漏洞，即它返回的"),a("code",[t._v("javascript")]),t._v("的内容被人控制的。那么结果是什么？所有调用这个"),a("code",[t._v("jsonp")]),t._v("的网站都会存在漏洞。于是无法把危险控制在一个域名下…所以在使用"),a("code",[t._v("jsonp")]),t._v("的时候必须要保证使用的"),a("code",[t._v("jsonp")]),t._v("服务必须是安全可信的。")])]),t._v(" "),a("hr"),t._v(" "),a("h3",{attrs:{id:"nginx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx"}},[t._v("#")]),t._v(" Nginx")]),t._v(" "),a("p",[t._v("Nginx 是一种高性能的"),a("code",[t._v("反向代理")]),t._v("服务器，可以用来轻松解决跨域问题。")]),t._v(" "),a("p",[a("strong",[t._v("Nginx")]),t._v("相较于"),a("strong",[t._v("CORS")]),t._v("，没有浏览器版本的限制，同时不会影响服务器的性能。")]),t._v(" "),a("p",[t._v("正向代理帮助客户端"),a("strong",[t._v("访问")]),t._v("客户端自己访问不到的服务器，然后将结果返回给客户端。")]),t._v(" "),a("p",[t._v("反向代理拿到客户端的请求，将请求转发给其他的服务器，主要的场景是维持服务器集群的"),a("strong",[t._v("负载均衡")]),t._v("，换句话说，反向代理帮"),a("strong",[t._v("其它的服务器")]),t._v("拿到请求，然后选择一个合适的服务器，将请求转交给它。")]),t._v(" "),a("p",[t._v("因此，两者的区别就很明显了，正向代理服务器是帮"),a("strong",[t._v("客户端")]),t._v("做事情，而反向代理服务器是帮其它的"),a("strong",[t._v("服务器")]),t._v("做事情。")]),t._v(" "),a("p",[t._v("那 Nginx 是如何来解决跨域的呢？")]),t._v(" "),a("p",[t._v("比如说现在客户端的域名为"),a("strong",[t._v("client.com")]),t._v("，服务器的域名为"),a("strong",[t._v("server.com")]),t._v("，客户端向服务器发送 Ajax 请求，当然会跨域了，那这个时候让 Nginx 登场了，通过下面这个配置:")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("server "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  listen  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  server_name  client"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  location "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("api "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("    proxy_pass server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("Nginx 相当于起了一个跳板机，这个跳板机的域名也是"),a("code",[t._v("client.com")]),t._v("，让客户端首先访问 "),a("code",[t._v("client.com/api")]),t._v("，这当然没有跨域，然后 Nginx 服务器作为反向代理，将请求转发给"),a("code",[t._v("server.com")]),t._v("，当响应返回时又将响应给到客户端，这就完成整个跨域请求的过程。")]),t._v(" "),a("h3",{attrs:{id:"window-postmessage"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#window-postmessage"}},[t._v("#")]),t._v(" window.postMessage")]),t._v(" "),a("p",[t._v("以下是"),a("a",{attrs:{href:"https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FWindow%2FpostMessage",target:"_blank",rel:"noopener noreferrer"}},[t._v("MDN"),a("OutboundLink")],1),t._v("对于"),a("code",[t._v("postMessage")]),t._v("介绍：")]),t._v(" "),a("blockquote",[a("p",[a("strong",[t._v("window.postMessage()")]),t._v(" 方法可以安全地实现跨源通信。通常，对于两个不同页面的脚本，只有当执行它们的页面位于具有相同的协议（通常为 https），端口号（443 为 https 的默认值），以及主机 (两个页面的模数 "),a("a",{attrs:{href:"https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FDocument%2Fdomain",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("Document.domain")]),a("OutboundLink")],1),t._v("设置为相同的值) 时，这两个脚本才能相互通信。"),a("strong",[t._v("window.postMessage()")]),t._v(" 方法提供了一种受控机制来规避此限制，只要正确的使用，这种方法就很安全。")])]),t._v(" "),a("p",[t._v("举例来说，父窗口"),a("code",[t._v("http://aaa.com")]),t._v("向子窗口"),a("code",[t._v("http://bbb.com")]),t._v("发消息，调用"),a("code",[t._v("postMessage")]),t._v("方法就可以了。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("const popup = window.open('http://bbb.com', 'title')popup.postMessage('你好，bbb!', 'http://bbb.com')\n")])])]),a("p",[a("code",[t._v("postMessage")]),t._v("方法的第一个参数是具体的信息内容，第二个参数是接收消息的窗口的源（"),a("code",[t._v("origin")]),t._v('），即"协议 + 域名 + 端口"。也可以设为'),a("code",[t._v("*")]),t._v("，表示不限制域名，向所有窗口发送。")]),t._v(" "),a("p",[t._v("子窗口向父窗口发送消息的写法类似")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("window.opener.postMessage('你好，aaa!', 'http://aaa.com')\n")])])]),a("p",[t._v("父窗口和子窗口都可以通过"),a("code",[t._v("message")]),t._v("事件，监听对方的消息")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("window.addEventListener('message', function(e) {  console.log(e.data) //消息内容  console.log(e.origin) //消息发向的网址  console.log(e.source) //发送消息的窗口},false)\n")])])]),a("h3",{attrs:{id:"websocket"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#websocket"}},[t._v("#")]),t._v(" Websocket")]),t._v(" "),a("p",[a("code",[t._v("WebSocket")]),t._v("是一种通信协议，使用"),a("code",[t._v("ws://")]),t._v("（非加密）和"),a("code",[t._v("wss://")]),t._v("（加密）作为协议前缀。该协议不实行同源政策，只要服务器支持，就可以通过它进行跨源通信。")]),t._v(" "),a("p",[t._v("它可以在网络浏览器和服务器之间建立“套接字”连接。简单地说：客户端和服务器之间存在持久的连接，而且双方都可以随时开始发送数据。详细教程可以看：")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://link.juejin.cn?target=https%3A%2F%2Fwww.html5rocks.com%2Fzh%2Ftutorials%2Fwebsockets%2Fbasics%2F",target:"_blank",rel:"noopener noreferrer"}},[t._v("WebSocket 简介：将套接字引入网络"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("这个没什么过多解释，直接上代码吧：")]),t._v(" "),a("p",[t._v("前端：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("const socket = new WebSocket('ws://www.abc.com')socket.onopen = () => {    socket.send('发送信息...')}socket.onmessage = (e) => {    console.log(e.data) //获取数据}\n")])])]),a("p",[t._v("服务端：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('const WebSocket = require("ws");const server = new WebSocket.Server({ port: 80 });server.on("connection", socket => {    socket.on("message", data => {        socket.send(data);    });});\n')])])]),a("h3",{attrs:{id:"webpack、vue-cli-等脚手架中开启-dev-server"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#webpack、vue-cli-等脚手架中开启-dev-server"}},[t._v("#")]),t._v(" webpack、Vue-CLI 等脚手架中开启 dev-server")]),t._v(" "),a("p",[a("strong",[t._v("原理是：将域名发送给本地的服务器（启动 vue 项目的服务,loclahost:8080），再由本地的服务器去请求真正的服务器。")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//vue.config.jsmodule.exports = {  devServer: {    proxy: {      '/api': {        target: 'http://www.example.com',        changeOrigin: true,        pathRewrite: {          '^/api': '',        },      },    },  },};")]),t._v("\n")])])]),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('//webpack.config.jsmodule.exports = {    ....    devServer: {        port: 80,        proxy: {          "/api": {            target: "http://www.example.com"          }        }    }}')]),t._v("\n")])])]),a("h3",{attrs:{id:"参考文章"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考文章"}},[t._v("#")]),t._v(" 参考文章")]),t._v(" "),a("ol",[a("li",[a("a",{attrs:{href:"https://juejin.cn/post/7063047193359286280",target:"_blank",rel:"noopener noreferrer"}},[t._v("跨域细节大盘点"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://juejin.cn/post/6844904100035821575",target:"_blank",rel:"noopener noreferrer"}},[t._v("HTTP 精讲"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://juejin.cn/post/6983852288091619342",target:"_blank",rel:"noopener noreferrer"}},[t._v("CORS 解密"),a("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=e.exports}}]);